{"ast":null,"code":"import axios from 'axios';\nimport AuthService from './auth.service';\nconst API_URL = \"http://localhost:8000/api/cliente/\";\nclass ClienteService {\n  constructor() {\n    this.refreshAuth();\n  }\n  refreshAuth() {\n    const user = AuthService.getCurrentUser();\n    if (user && user.accessToken) {\n      // Configuração global para todas as requisições axios\n      axios.defaults.headers.common['Authorization'] = 'Bearer ' + user.accessToken;\n      // Manter apenas x-access-token, que é o formato que o servidor espera\n      axios.defaults.headers.common['x-access-token'] = user.accessToken;\n      console.log(\"ClienteService - Token disponível:\", user.accessToken ? \"Sim\" : \"Não\");\n      console.log(\"ClienteService - Token configurado nos headers do Axios\");\n    }\n  }\n  async getClienteProfile() {\n    try {\n      console.log(\"Buscando perfil do cliente em: \" + API_URL + \"perfil\");\n      const user = AuthService.getCurrentUser();\n\n      // Verificar se temos o token disponível\n      if (!user || !user.accessToken) {\n        console.error(\"Token de autenticação não disponível\");\n        return {\n          error: true,\n          message: \"Token não disponível\"\n        };\n      }\n\n      // Atualizar os headers a cada requisição para garantir token atualizado\n      console.log(\"Enviando token:\", user.accessToken.substring(0, 20) + \"...\");\n\n      // Primeira tentativa: método GET com token nos headers\n      try {\n        return await axios.get(API_URL + \"perfil\", {\n          headers: {\n            \"x-access-token\": user.accessToken,\n            \"Authorization\": \"Bearer \" + user.accessToken\n          }\n        });\n      } catch (error) {\n        this.logErrorDetails(error);\n        console.log(\"Tentando alternativa com método POST...\");\n        // Segunda tentativa: método POST com token no corpo\n        try {\n          return await axios.post(API_URL + \"perfil\", {\n            token: user.accessToken\n          }, {\n            headers: {\n              \"Content-Type\": \"application/json\",\n              \"Authorization\": \"Bearer \" + user.accessToken\n            }\n          });\n        } catch (secondError) {\n          console.error(\"Segunda tentativa também falhou:\", secondError.message);\n          throw error; // Lançar o erro original\n        }\n      }\n    } catch (error) {\n      this.logErrorDetails(error);\n      throw error;\n    }\n  }\n  logErrorDetails(error) {\n    console.error(\"Erro ao comunicar com a API:\", error.message);\n    if (error.response) {\n      console.log(\"Status:\", error.response.status);\n      console.log(\"Dados:\", error.response.data);\n      console.log(\"Headers:\", error.response.headers);\n      console.log(\"Cabeçalhos enviados:\", error.config.headers);\n    } else if (error.request) {\n      console.log(\"Request enviado, sem resposta:\", error.request);\n    }\n    console.log(\"Config completa:\", error.config);\n  }\n\n  // Atualizar perfil do cliente\n  async updateClienteProfile(clienteData) {\n    this.refreshAuth(); // Garante que o token está atualizado\n    console.log(\"Atualizando perfil, dados:\", clienteData);\n    return axios.put(`${API_URL}/perfil`, clienteData, {\n      headers: {\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\n      }\n    });\n  }\n\n  // Obter histórico de consultas do cliente\n  async getConsultas() {\n    this.refreshAuth(); // Garante que o token está atualizado\n    return axios.get(`${API_URL}/consultas`, {\n      headers: {\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\n      }\n    });\n  }\n}\nexport default new ClienteService();","map":{"version":3,"names":["axios","AuthService","API_URL","ClienteService","constructor","refreshAuth","user","getCurrentUser","accessToken","defaults","headers","common","console","log","getClienteProfile","error","message","substring","get","logErrorDetails","post","token","secondError","response","status","data","config","request","updateClienteProfile","clienteData","put","getConsultas"],"sources":["C:/Users/s0ares/clinicadentaria_ai2/client/src/services/cliente.service.js"],"sourcesContent":["import axios from 'axios';\r\nimport AuthService from './auth.service';\r\n\r\nconst API_URL = \"http://localhost:8000/api/cliente/\";\r\n\r\nclass ClienteService {\r\n  constructor() {\r\n    this.refreshAuth();\r\n  }\r\n  \r\n  refreshAuth() {\r\n    const user = AuthService.getCurrentUser();\r\n    if (user && user.accessToken) {\r\n      // Configuração global para todas as requisições axios\r\n      axios.defaults.headers.common['Authorization'] = 'Bearer ' + user.accessToken;\r\n      // Manter apenas x-access-token, que é o formato que o servidor espera\r\n      axios.defaults.headers.common['x-access-token'] = user.accessToken;\r\n      \r\n      console.log(\"ClienteService - Token disponível:\", user.accessToken ? \"Sim\" : \"Não\");\r\n      console.log(\"ClienteService - Token configurado nos headers do Axios\");\r\n    }\r\n  }\r\n\r\n  async getClienteProfile() {\r\n    try {\r\n      console.log(\"Buscando perfil do cliente em: \" + API_URL + \"perfil\");\r\n      const user = AuthService.getCurrentUser();\r\n      \r\n      // Verificar se temos o token disponível\r\n      if (!user || !user.accessToken) {\r\n        console.error(\"Token de autenticação não disponível\");\r\n        return { error: true, message: \"Token não disponível\" };\r\n      }\r\n\r\n      // Atualizar os headers a cada requisição para garantir token atualizado\r\n      console.log(\"Enviando token:\", user.accessToken.substring(0, 20) + \"...\");\r\n      \r\n      // Primeira tentativa: método GET com token nos headers\r\n      try {\r\n        return await axios.get(API_URL + \"perfil\", {\r\n          headers: {\r\n            \"x-access-token\": user.accessToken,\r\n            \"Authorization\": \"Bearer \" + user.accessToken\r\n          }\r\n        });\r\n      } catch (error) {\r\n        this.logErrorDetails(error);\r\n        \r\n        console.log(\"Tentando alternativa com método POST...\");\r\n        // Segunda tentativa: método POST com token no corpo\r\n        try {\r\n          return await axios.post(API_URL + \"perfil\", \r\n            { token: user.accessToken },\r\n            { \r\n              headers: { \r\n                \"Content-Type\": \"application/json\",\r\n                \"Authorization\": \"Bearer \" + user.accessToken\r\n              }\r\n            }\r\n          );\r\n        } catch (secondError) {\r\n          console.error(\"Segunda tentativa também falhou:\", secondError.message);\r\n          throw error; // Lançar o erro original\r\n        }\r\n      }\r\n    } catch (error) {\r\n      this.logErrorDetails(error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  logErrorDetails(error) {\r\n    console.error(\"Erro ao comunicar com a API:\", error.message);\r\n    if (error.response) {\r\n      console.log(\"Status:\", error.response.status);\r\n      console.log(\"Dados:\", error.response.data);\r\n      console.log(\"Headers:\", error.response.headers);\r\n      console.log(\"Cabeçalhos enviados:\", error.config.headers);\r\n    } else if (error.request) {\r\n      console.log(\"Request enviado, sem resposta:\", error.request);\r\n    }\r\n    console.log(\"Config completa:\", error.config);\r\n  }\r\n\r\n  // Atualizar perfil do cliente\r\n  async updateClienteProfile(clienteData) {\r\n    this.refreshAuth(); // Garante que o token está atualizado\r\n    console.log(\"Atualizando perfil, dados:\", clienteData);\r\n    return axios.put(`${API_URL}/perfil`, clienteData, {\r\n      headers: {\r\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\r\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\r\n      }\r\n    });\r\n  }\r\n\r\n  // Obter histórico de consultas do cliente\r\n  async getConsultas() {\r\n    this.refreshAuth(); // Garante que o token está atualizado\r\n    return axios.get(`${API_URL}/consultas`, {\r\n      headers: {\r\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\r\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default new ClienteService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}