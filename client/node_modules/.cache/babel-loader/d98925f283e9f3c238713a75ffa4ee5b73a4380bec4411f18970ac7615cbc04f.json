{"ast":null,"code":"import axios from 'axios';\nimport AuthService from './auth.service';\nconst API_URL = \"http://localhost:8000/api/cliente/\";\nclass ClienteService {\n  constructor() {\n    this.refreshAuth();\n  }\n  refreshAuth() {\n    const user = AuthService.getCurrentUser();\n    if (user && user.accessToken) {\n      // Configuração global para todas as requisições axios\n      axios.defaults.headers.common['Authorization'] = 'Bearer ' + user.accessToken;\n      axios.defaults.headers.common['x-access-token'] = user.accessToken;\n      console.log(\"ClienteService - Token disponível:\", user.accessToken ? \"Sim\" : \"Não\");\n      console.log(\"ClienteService - Token configurado nos headers do Axios\");\n    }\n  }\n  async getClienteProfile() {\n    try {\n      console.log(\"Buscando perfil do cliente em: \" + API_URL + \"perfil\");\n      const user = AuthService.getCurrentUser();\n\n      // Verificar se temos o token disponível\n      if (!user || !user.accessToken) {\n        console.error(\"Token de autenticação não disponível\");\n        return {\n          error: true,\n          message: \"Token não disponível\"\n        };\n      }\n\n      // Atualizar os headers a cada requisição para garantir token atualizado\n      console.log(\"Enviando token:\", user.accessToken.substring(0, 20) + \"...\");\n\n      // Garantir que o token seja incluído no cabeçalho da requisição\n      const response = await axios.get(API_URL + \"perfil\", {\n        headers: {\n          \"x-access-token\": user.accessToken,\n          \"Authorization\": \"Bearer \" + user.accessToken,\n          \"Content-Type\": \"application/json\"\n        },\n        withCredentials: true // Incluir cookies na requisição se o backend usar sessions\n      });\n      console.log(\"Resposta da API:\", response.status);\n      return response;\n    } catch (error) {\n      this.logErrorDetails(error);\n      throw error;\n    }\n  }\n  logErrorDetails(error) {\n    console.error(\"Erro ao comunicar com a API:\", error.message);\n    if (error.response) {\n      console.log(\"Status:\", error.response.status);\n      console.log(\"Dados:\", error.response.data);\n      console.log(\"Headers:\", error.response.headers);\n\n      // Imprimir cabeçalhos enviados\n      console.log(\"Cabeçalhos enviados:\", error.config.headers);\n    } else if (error.request) {\n      console.log(\"Request enviado, sem resposta:\", error.request);\n    }\n    console.log(\"Config completa:\", error.config);\n  }\n\n  // Atualizar perfil do cliente\n  async updateClienteProfile(clienteData) {\n    this.refreshAuth(); // Garante que o token está atualizado\n    console.log(\"Atualizando perfil, dados:\", clienteData);\n    return axios.put(`${API_URL}/perfil`, clienteData, {\n      headers: {\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\n      }\n    });\n  }\n\n  // Obter histórico de consultas do cliente\n  async getConsultas() {\n    this.refreshAuth(); // Garante que o token está atualizado\n    return axios.get(`${API_URL}/consultas`, {\n      headers: {\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\n      }\n    });\n  }\n}\nexport default new ClienteService();","map":{"version":3,"names":["axios","AuthService","API_URL","ClienteService","constructor","refreshAuth","user","getCurrentUser","accessToken","defaults","headers","common","console","log","getClienteProfile","error","message","substring","response","get","withCredentials","status","logErrorDetails","data","config","request","updateClienteProfile","clienteData","put","getConsultas"],"sources":["C:/Users/s0ares/clinicadentaria_ai2/client/src/services/cliente.service.js"],"sourcesContent":["import axios from 'axios';\r\nimport AuthService from './auth.service';\r\n\r\nconst API_URL = \"http://localhost:8000/api/cliente/\";\r\n\r\nclass ClienteService {\r\n  constructor() {\r\n    this.refreshAuth();\r\n  }\r\n  \r\n  refreshAuth() {\r\n    const user = AuthService.getCurrentUser();\r\n    if (user && user.accessToken) {\r\n      // Configuração global para todas as requisições axios\r\n      axios.defaults.headers.common['Authorization'] = 'Bearer ' + user.accessToken;\r\n      axios.defaults.headers.common['x-access-token'] = user.accessToken;\r\n      \r\n      console.log(\"ClienteService - Token disponível:\", user.accessToken ? \"Sim\" : \"Não\");\r\n      console.log(\"ClienteService - Token configurado nos headers do Axios\");\r\n    }\r\n  }\r\n\r\n  async getClienteProfile() {\r\n    try {\r\n      console.log(\"Buscando perfil do cliente em: \" + API_URL + \"perfil\");\r\n      const user = AuthService.getCurrentUser();\r\n      \r\n      // Verificar se temos o token disponível\r\n      if (!user || !user.accessToken) {\r\n        console.error(\"Token de autenticação não disponível\");\r\n        return { error: true, message: \"Token não disponível\" };\r\n      }\r\n\r\n      // Atualizar os headers a cada requisição para garantir token atualizado\r\n      console.log(\"Enviando token:\", user.accessToken.substring(0, 20) + \"...\");\r\n      \r\n      // Garantir que o token seja incluído no cabeçalho da requisição\r\n      const response = await axios.get(API_URL + \"perfil\", {\r\n        headers: {\r\n          \"x-access-token\": user.accessToken,\r\n          \"Authorization\": \"Bearer \" + user.accessToken,\r\n          \"Content-Type\": \"application/json\"\r\n        },\r\n        withCredentials: true // Incluir cookies na requisição se o backend usar sessions\r\n      });\r\n      \r\n      console.log(\"Resposta da API:\", response.status);\r\n      return response;\r\n    } catch (error) {\r\n      this.logErrorDetails(error);\r\n      throw error;\r\n    }\r\n  }\r\n  \r\n  logErrorDetails(error) {\r\n    console.error(\"Erro ao comunicar com a API:\", error.message);\r\n    if (error.response) {\r\n      console.log(\"Status:\", error.response.status);\r\n      console.log(\"Dados:\", error.response.data);\r\n      console.log(\"Headers:\", error.response.headers);\r\n      \r\n      // Imprimir cabeçalhos enviados\r\n      console.log(\"Cabeçalhos enviados:\", error.config.headers);\r\n    } else if (error.request) {\r\n      console.log(\"Request enviado, sem resposta:\", error.request);\r\n    }\r\n    console.log(\"Config completa:\", error.config);\r\n  }\r\n\r\n  // Atualizar perfil do cliente\r\n  async updateClienteProfile(clienteData) {\r\n    this.refreshAuth(); // Garante que o token está atualizado\r\n    console.log(\"Atualizando perfil, dados:\", clienteData);\r\n    return axios.put(`${API_URL}/perfil`, clienteData, {\r\n      headers: {\r\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\r\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\r\n      }\r\n    });\r\n  }\r\n\r\n  // Obter histórico de consultas do cliente\r\n  async getConsultas() {\r\n    this.refreshAuth(); // Garante que o token está atualizado\r\n    return axios.get(`${API_URL}/consultas`, {\r\n      headers: {\r\n        \"x-access-token\": AuthService.getCurrentUser().accessToken,\r\n        \"Authorization\": \"Bearer \" + AuthService.getCurrentUser().accessToken\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nexport default new ClienteService();"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}